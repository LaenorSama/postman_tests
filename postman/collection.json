if (!pm.globals.has("testResults")) {
    pm.globals.set("testResults", JSON.stringify([]));
}

let currentResults = JSON.parse(pm.globals.get("testResults"));

var testName = "–°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞ 200 –¥–ª—è Get assigned members";
var passed = pm.response.code === 200;

pm.test("Test: " + testName, () => {
    pm.expect(pm.response.code).to.eql(200);
});

var responseTime = pm.response.responseTime;
console.log(`‚è± –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ –¥–ª—è Get assigned members: ${responseTime} –º—Å`);

console.log(`üìã –¢–µ—Å—Ç—ã –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞: ${pm.info.requestName}`);
console.log(`${passed ? "‚úÖ" : "‚ùå"} ${testName}`);

currentResults.push({
    request: pm.info.requestName,
    test: testName,
    passed: passed,
    status: pm.response.code,
    time: responseTime
});

pm.globals.set("testResults", JSON.stringify(currentResults));

var totalRequests = parseInt(pm.environment.get("totalRequests") || "0") + 1;
var totalTime = parseInt(pm.environment.get("totalTime") || "0") + responseTime;

pm.environment.set("totalRequests", totalRequests);
pm.environment.set("totalTime", totalTime);
pm.environment.set("avgTime", (totalTime / totalRequests).toFixed(2));

if (!passed) {
    var failures = pm.environment.get("failures") || "";
    failures += `\n[${pm.info.requestName}] - —Å—Ç–∞—Ç—É—Å: ${pm.response.code}`;
    pm.environment.set("failures", failures);
}

testName = "–°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞ 200 –¥–ª—è Get projects";
passed = pm.response.code === 200;

pm.test("Test: " + testName, () => {
    pm.expect(pm.response.code).to.eql(200);
});

responseTime = pm.response.responseTime;
console.log(`‚è± –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ –¥–ª—è Get projects: ${responseTime} –º—Å`);

console.log(`üìã –¢–µ—Å—Ç—ã –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞: ${pm.info.requestName}`);
console.log(`${passed ? "‚úÖ" : "‚ùå"} ${testName}`);

currentResults.push({
    request: pm.info.requestName,
    test: testName,
    passed: passed,
    status: pm.response.code,
    time: responseTime
});

pm.globals.set("testResults", JSON.stringify(currentResults));

totalRequests = parseInt(pm.environment.get("totalRequests") || "0") + 1;
totalTime = parseInt(pm.environment.get("totalTime") || "0") + responseTime;

pm.environment.set("totalRequests", totalRequests);
pm.environment.set("totalTime", totalTime);
pm.environment.set("avgTime", (totalTime / totalRequests).toFixed(2));

if (!passed) {
    failures = pm.environment.get("failures") || "";
    failures += `\n[${pm.info.requestName}] - —Å—Ç–∞—Ç—É—Å: ${pm.response.code}`;
    pm.environment.set("failures", failures);
}
